(function(){function e(e){e=e||{},this.path=e.path||"/",this.domain=e.domain||"",this.expires=e.expires||31536e6,this.secure=e.secure||""}e.prototype={set:function(e,t){var n=new Date;typeof this.expires=="number"&&n.setTime(n.getTime()+this.expires),document.cookie=e+"="+escape(t)+";expires="+n.toGMTString()+";path="+this.path+(this.domain==""?"":"; domain="+this.domain)+(this.secure?"; secure":"")},get:function(e){var t,n=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(n))?unescape(t[2]):""},remove:function(e){var t=this.expires;this.expires=-31536e6,this.set(e,""),this.expires=t}},e.set=function(t,n,r){(new e(r)).set(t,n)},e.get=function(t,n){return(new e(n)).get(t)},e.remove=function(t,n){(new e(n)).remove(t)},typeof QW=="object"?QW.provide("Cookie",e):window.Cookie=e})(),namespace("yunpan.util"),yunpan.util.Lazyload=function(e){function s(){var e;n._isForBody?e=document.body.scrollTop||document.documentElement.scrollTop||0:e=r.scrollTop,Math.abs(e-n.scrollTop)>i&&(n.scrollTop=e,n.loadImg())}var t=this.options=ObjectH.mix({threshold:0,selector:"img",lazyLength:25,type:"src"},e,!0);if(!t.container)return;this.container=W(t.container),this.container[0]==document.body&&(this._isForBody=!0),this.images=this.container.query(t.selector).toArray(),this._isForBody?this.scrollTop=document.body.scrollTop||document.documentElement.scrollTop||0:this.scrollTop=this.container[0].scrollTop;var n=this,r=n.container[0],i=t.lazyLength,o;this._onScroll=function(){o&&(clearTimeout(o),o=null),o=setTimeout(s,t.checkInterval)},t.checkInterval||(this._onScroll=s)},yunpan.util.Lazyload.prototype={start:function(){this._isForBody?W(window).on("scroll",this._onScroll):this.container.on("scroll",this._onScroll),this.loadImg()},stop:function(){this._isForBody?W(window).un("scroll",this._onScroll):this.container.un("scroll",this._onScroll)},loadImg:function(){if(this.images.length<=0){this.stop();return}var e=this,t=this.options.type=="src",n=this.options.threshold,r=[],i=this.options.onLoadFunc?this.options.onLoadFunc:null;if(this._isForBody){var s=Dom.getDocRect(),o=s.scrollX,u=s.scrollY,a=s.width,f=s.height;this.images.forEach(function(e,i){try{e=W(e);var s=e.getRect();s.bottom+n-u<0||s.top-n-u>f||s.right+n-o<0||s.left-n-o>a?r.push(e):t?e.attr("src",e.attr("data-imgurl")):e.setStyle("background-image","url("+e.attr("data-imgurl")+")")}catch(l){}})}else{var l=this.container.getRect(),c=l.top,h=l.bottom,p=l.left,d=l.right;this.images.forEach(function(e,s){try{e=W(e);var o=e.getRect();o.bottom+n<c||o.top-n>h||o.right+n<p||o.left-n>d?r.push(e):t?(i&&e.on("load",i),e.attr("src",e.attr("data-imgurl"))):e.setStyle("background-image","url("+e.attr("data-imgurl")+")")}catch(u){}})}this.images=r}},namespace("yunpan"),yunpan.Storage=function(){function e(e){return e.replace(/[_\s]/g,function(e){return e=="_"?"__":"_s"})}function t(){var e;try{window.localStorage?e=r():window.ActiveXObject?e=n():e=i()}catch(t){window.ActiveXObject?e=n():e=i()}return e}function n(){W('<div id="ypStorage" style="display:none;"></div>').insertTo("beforeend",document.body);var t=g("ypStorage");t.addBehavior("#default#userData");var n=new Date;return n.setDate(n.getDate()+365),t.expires=n.toUTCString(),{set:function(n,r){var i=e(n);try{t.load("yunpanuserdata"),t.setAttribute(i,r),t.save("yunpanuserdata")}catch(s){}},get:function(n){var r=e(n),i=null;try{t.load("yunpanuserdata"),i=t.getAttribute(r)}catch(s){}return i},del:function(n){var r=e(n);try{t.load("yunpanuserdata"),t.removeAttribute(r),t.save("yunpanuserdata")}catch(i){}}}}function r(){return{set:function(t,n,r){var i=window.localStorage,s=e(t);try{i.setItem(s,n)}catch(o){}},get:function(t){var n=window.localStorage,r=e(t),i=null,s,o;try{i=n.getItem(r)}catch(u){}return i},del:function(t){var n=window.localStorage,r=e(t),i=null;try{i=n.getItem(r)}catch(s){}i&&n.removeItem(r)}}}function i(){return{set:function(t,n){Cookie.set(e(t),n)},get:function(t){return Cookie.get(e(t))},del:function(t){Cookie.remove(e(t))}}}return{set:function(e,n){var r=this;!r._storage&&(r._storage=t()),r._storage.set(e,n)},get:function(e){var n=this;return!n._storage&&(n._storage=t()),n._storage.get(e)},remove:function(e){var n=this;!n._storage&&(n._storage=t()),n._storage.del(e)},proxy:function(e){var t="http://yunpan.360.cn/resource/html/storage.html#",n=[];for(var r in e)n.push(encodeURIComponent(r)+"="+encodeURIComponent(e[r]));t+=n.join("&"),W('<iframe style="display:none;width:0;height:0;border:none" src="'+t+'"></iframe>').insertTo("beforeend",document.body)}}}(),function(){function x(t){return e(this,t,1),this.lazyRender||this.render(),this}function T(t){return e(this,t,1),this.lazyRender||this.render(),this}function N(t){return e(this,t,1),this.lazyRender||this.render(),this}var e=QW.ObjectH.mix,t=QW.ArrayH.remove,n=QW.StringH.format,r=QW.Browser.ie6,i=QW.DomU,s=i.createElement,o=i.getDocRect,u=QW.NodeH,a=QW.EventTargetH.addEventListener,f=QW.EventTargetH.removeEventListener,l=u.fire,c=u.hide,h=u.setStyle,p=u.getXY,d=function(e,t,n,r,s){var o=i.getDocRect();r==null&&(r=(o.width-t)/2+o.scrollX),r=Math.max(Math.min(r,o.scrollX+o.width-t),o.scrollX),s==null&&(s=(o.height-n)/2+o.scrollY),s=Math.max(Math.min(s,o.scrollY+o.height-n),o.scrollY),u.setXY(e,r,s)},v=u.contains,m=u.removeNode,g=QW.EventH,y=g.getTarget,b=g.getKeyCode,w=g.preventDefault,E=QW.CustEvent,S={VERSION:"0.0.1"};(function(){function v(){var e=s("div",{className:"mask",tabIndex:-1,unselectable:"on"});return document.body.insertBefore(e,document.body.firstChild),e}function g(){var e=u.offsetParent,t=document.documentElement,n=u.style;if(parseInt(n.top)!=e.scrollTop||parseInt(n.left)!=e.scrollLeft)n.top=e.scrollTop,n.left=e.scrollLeft;t.clientHeight!=u.offsetHeight&&(n.height=t.clientHeight),t.clientWidth!=u.offsetWidth&&(n.width=t.clientWidth)}function y(e){e.keyEsc&&(f(document,"keydown",S.keydownHdl),a(document,"keydown",S.keydownHdl))}var n=100,i=[],u,l=0;e(S,{showPanel:function(e,s,a,f,c,m){e._rendered&&e.render(),t(i,e),i.push(e);var b=e.oWrap.style;e.isVisible?b.zIndex!=n&&(b.zIndex=n+=2):b.zIndex=n+=2,e.withMask&&(u=u||v(),h(u,{zIndex:n-1,display:"block"}),r&&(g(u),clearInterval(l),l=setInterval(g,1e3))),f!=null&&(b.width=f+"px"),c!=null&&(b.height=c+"px");if(e.posCenter){var w=S.getWrapSize(e);d(e.oWrap,w[0],w[1],s,a)}else{s=s||0,a=a||0;if(m){var E=p(m);s+=E[0],a+=E[1]}if(e.posAdjust){var w=S.getWrapSize(e),x=o();s=Math.min(s,x.scrollX+x.width-w[0]),s=Math.max(s,x.scrollX),a=Math.min(a,x.scrollY+x.height-w[1]),a=Math.max(a,x.scrollY)}b.left=s+"px",b.top=a+"px"}b.display="block",e.isVisible=!0,y(e)},hidePanel:function(e){c(e.oWrap),e.isVisible=!1,t(i,e);var n=!1;for(var r=i.length-1;r>-1;r--){var s=i[r];if(s.withMask){u.style.zIndex=s.oWrap.style.zIndex-1,n=!0;break}}!n&&u&&(c(u),clearInterval(l))},disposePanel:function(e){m(e.oWrap);for(var t in e)e[t]=null},risePanel:function(e){if(!e.isVisible)throw alert("\u7a0b\u5e8f\u9519\u8bef."),"\u9519\u8bef\uff1a\u8fd8\u6ca1\u6709\u6253\u5f00panel\u5462.";var r=e.oWrap.style;if(r.zIndex!=n){r.zIndex=n+=2,t(i,e),i.push(e);if(e.withMask){var s=u.style;s.zIndex=n-1}}},keydownHdl:function(e){if(i.length&&b(e)==27){var t=i[i.length-1];t.keyEsc&&(t.hide(),w(e))}i.length||f(document,"keydown",S.keydownHdl)},getWrapSize:function(e,t,n){var r=e.oWrap,i=r.style,s=[i.display,i.width,i.height];i.display="block",t&&(i.width=t),n&&(i.height=n);var o=[r.offsetWidth,r.offsetHeight];return i.display=s[0],s[1]&&(i.width=s[1]),s[2]&&(i.height=s[2]),o}})})(),function(){function e(e,t){t=t||"",t.tagName?(e.innerHTML="",e.appendChild(t)):e.innerHTML=t}x.EVENTS=["beforeshow","aftershow","beforehide","afterhide"],x._elHtml={content:'<div class="panel-content" remark="oContent"><div class="hd"></div><div class="bd"></div><div class="ft"></div></div>',closeHdl:'<span class="close"></span>',resizeHdl:'<span class="resize"><span></span></span>',corner1:'<span class="co1"><span></span></span>',corner2:'<span class="co2"><span></span></span>',cue:'<span class="cue"></span>',shadow:'<span class="sd"></span>'},x.prototype={defaultClassName:"panel",wrapId:"",className:"",title:"",header:"",body:"Panel Body",footer:"",withCorner:0,withCue:0,withShadow:0,withClose:0,withMask:0,dragable:0,resizable:0,keyEsc:0,posCenter:0,posAdjust:0,isVisible:!1,oWrap:null,oContent:null,oHeader:null,oBody:null,oFooter:null,oCloseHdl:null,oResizeHdl:null,oShadow:null,oCue:null,oCorner1:null,oCorner2:null,render:function(){var t=this;if(t._rendered)return;var n=s("div",{className:t.defaultClassName+" "+(t.className||"")});n.style.display="none",t.oWrap=n,t.wrapId&&(n.id=t.wrapId),c(n);var r=x._elHtml,i=[r.content,t.withClose?r.closeHdl:"",t.resizable?r.resizeHdl:"",t.withCorner?r.corner1+r.corner2:"",t.withCue?r.cue:"",t.withShadow?r.shadow:""];n.innerHTML=i.join("");var o=n.childNodes;t.oContent=o[0];var u=1;t.withClose&&(t.oCloseHdl=o[u++]),t.resizable&&(t.oResizeHdl=o[u++]),t.withCorner&&(t.oCorner1=o[u++],t.oCorner2=o[u++]),t.withCue&&(t.oCue=o[u++]),t.withShadow&&(t.oShadow=o[u++]);var o=t.oContent.childNodes;t.oHeader=o[0],t.oBody=o[1],t.oFooter=o[2],t.isVisible=!1;var f=t.title&&"<h3>"+t.title+"</h3>"||t.header;f&&e(t.oHeader,f),t.body&&e(t.oBody,t.body),t.footer&&e(t.oFooter,t.footer),t.withClose&&a(t.oCloseHdl,"click",function(){t.hide()}),t.dragable&&t.initDrag(),t.resizable&&t.initResize(),document.body.insertBefore(n,document.body.firstChild),E.createEvents(t,x.EVENTS),t._rendered=!0},show:function(e,t,n,r,i){return this._rendered&&this.render(),this.fire("beforeshow")==0?!1:(S.showPanel(this,e,t,n,r,i),this.fire("aftershow"),!0)},hide:function(){return this.fire("beforehide")==0?!1:(S.hidePanel(this),this.fire("afterhide"),!0)},dispose:function(){if(this.isVisible)return!1;S.disposePanel(this)},rise:function(){S.risePanel(this)},initDrag:function(){var e=this,t=new QW.SimpleDrag({oSrc:this.oWrap,oHdl:this.oHeader,minXAttr:1,minYAttr:1,maxXAttr:this.maxXAttr,maxYAttr:this.maxYAttr,withProxy:!0});t.on("dragstart",function(){e.rise()})},initResize:function(){var e=this,t=new QW.SimpleResize({oSrc:this.oWrap,oHdl:this.oResizeHdl,minXAttr:150,yFixed:!0,withProxy:!0});t.on("dragstart",function(){e.rise()})}}}(),function(){T.MENTOR_CLASS=x,T.prototype={posAdjust:1,defaultClassName:"panel panel-popup",relatedEls:null,_refreshBlurHdl:function(e){this._fnBlur&&(f(document,"keydown",this._fnBlur),f(document,"keyup",this._fnBlur),f(document,"mousedown",this._fnBlur),e&&(a(document,"keydown",this._fnBlur),a(document,"keyup",this._fnBlur),a(document,"mousedown",this._fnBlur)))},show:function(e,t,n,r,i){var s=this;return s._rendered&&s.render(),s._fnBlur=s._fnBlur||function(e){var t=y(e)||document.body;if(!s.oWrap)return;var n=s.relatedEls||[];n.push(s.oWrap);for(var r=0;r<n.length;r++){var i=n[r];if(i==t||v(i,t))return}s.hide()},s.fire("beforeshow")==0?!1:(S.showPanel(s,e,t,n,r,i),s._refreshBlurHdl(!0),s.fire("aftershow"),!0)},hide:function(){return this.fire("beforehide")==0?!1:(S.hidePanel(this),this._refreshBlurHdl(!1),this.fire("afterhide"),!0)}},e(T.prototype,x.prototype)}(),function(){N.MENTOR_CLASS=x,N.prototype={defaultClassName:"panel panel-dialog",withMask:1,withClose:1,dragable:!!QW.SimpleDrag},e(N.prototype,x.prototype)}();var C=function(){var t={alert:'<div class="panel-dialog-sys panel-alert cls"><div class="msg">{0}</div><div class="btn-ctn"><button>\u786e\u5b9a</button></div></div>',confirm:'<div class="panel-dialog-sys panel-confirm cls"><div class="msg">{0}</div><div class="btn-ctn"><button>\u786e\u5b9a</button><button>\u53d6\u6d88</button></div></div>',prompt:'<div class="panel-dialog-sys panel-prompt cls"><div class="msg">{0}</div><div class="ipt-ctn"><input type="text-input"></div><div class="btn-ctn"><button>\u786e\u5b9a</button><button>\u53d6\u6d88</button></div></div>',msgbox:'<div class="panel-dialog-sys panel-msgbox cls"><div class="msg">{0}</div><div class="btn-ctn"><button>\u662f(Yes)</button><button>\u5426(No)</button><button>\u53d6\u6d88</button></div></div>'},r={getSysDialog:function(r,i,s,o){o=o||{},e(o,{posCenter:1,keyEsc:1,title:"\u7cfb\u7edf\u63d0\u793a",dragable:!!QW.SimpleDrag,body:n(t[r]||"error",i)});var u=new N(o),f=u.oWrap.getElementsByTagName("button");u.dialogButtons=f;switch(r){case"alert":a(f[0],"click",function(e){u.hide()});break;case"confirm":a(f[0],"click",function(e){u.returnValue=!0,u.hide()}),a(f[1],"click",function(e){u.hide()}),u.returnValue=!1;break;case"prompt":var c=u.oWrap.getElementsByTagName("input")[0];u.dialogInput=c,a(c,"keydown",function(e){b(e)==g.KEY_ENTER&&setTimeout(function(){l(f[0],"click")},10)}),a(f[0],"click",function(e){u.returnValue=c.value,u.hide()}),a(f[1],"click",function(e){u.hide()});break;case"msgbox":a(f[0],"click",function(e){u.returnValue=!0,u.hide()}),a(f[1],"click",function(e){u.returnValue=!1,u.hide()}),a(f[2],"click",function(e){u.hide()})}return u.on("aftershow",function(){var e=c||f[0];try{e.focus(),e.select()}catch(t){}}),u.on("afterhide",function(){try{s&&s(this.returnValue)}finally{}}),u},_sysDialog:function(e,t,n,r,i){i=i||{};var s=QW.Panel.getSysDialog(e,t,r,i);e=="prompt"&&(s.dialogInput.value=n||""),s.show(null,null,i.width||300,i.height)},alert:function(e,t,n){QW.Panel._sysDialog("alert",e,null,t,n)},confirm:function(e,t,n){QW.Panel._sysDialog("confirm",e,null,t,n)},prompt:function(e,t,n,r){QW.Panel._sysDialog("prompt",e,t,n,r)},msgbox:function(e,t,n){QW.Panel._sysDialog("msgbox",e,null,t,n)}};return r}();QW.provide({PanelManager:S,BasePanel:x,LayerPopup:T,LayerDialog:N,Panel:C})}(),namespace("yunpan"),yunpan.dialog=function(){function t(t){var n={wrapId:"BasePanel"+ ++e,className:"panel-t1",title:"",header:"",body:"",footer:"",withClose:!0,withCorner:!1,withCue:!1,withShadow:!1,withBgIframe:!0,keyEsc:!0,withMask:!0,dragable:!!QW.SimpleDrag,resizable:!1,posCenter:!0,posAdjust:!1,aftershowcallback:null};Object.mix(n,t,!0);var r=new QW.BasePanel(n);n.withClose&&W(r.oWrap).query(".close").appendChild(W('<a class="close-link" href="###" onclick="return false;"><span>\u5173\u95ed</span></a>'));if(t.buttons){for(var i=0,s=t.buttons.length;i<s;i++){var o=t.buttons[i],u=o.cls?" "+o.cls:"",a=o.type?o.type=="blue"?"blue":"gray":o.text=="\u786e\u5b9a"?"blue":"gray",f=o.style?' style="'+o.style+'"':"",l=o.id?" id="+o.id:"";btnHtml=['<span class="y-btn y-btn-'+a+u+'"'+f+l+">",o.withIcon?'<i class="icon"></i>':"",o.text,"</span>"].join("");var c=W(btnHtml).insertTo("beforeend",r.oFooter);o.handler&&c.on("click",o.handler)}W(r.oFooter).css("display","")}else W(r.oFooter).addClass("ft-none");return r.on("aftershow",function(){var e=W(r.oContent),n=e.getRect();W(r.oHeader).css("width",n.width+"px"),W(r.oFooter).css("width",n.width+"px"),t.aftershowcallback&&t.aftershowcallback()}),r}var e=0;return{create:t}}(),function(e,t){typeof exports=="object"?module.exports=t():typeof define=="function"&&define.amd?define("module/xpc/0.3/xpc",[],t):e.XPC=t()}(this,function(){function o(e,t){this.name=t||"XPC_IFRAME",this.target=e}function u(n,r){this.targets={},this.name=n||"MAIN_DOC",this.listenFunc=[],t(this);var i=e({defaultMain:!0},r||{},!0);!s&&i.defaultMain&&this.addTarget("MAIN_DOC"),this.initListen()}var e=function(e,t,n){n=n||function(t,n,r){return e[r]||r in e?t:n},n===!0&&(n=function(e,t){return t});for(var r in t)e[r]=n(e[r],t[r],r,e,t),e[r]===undefined&&delete e[r];return e},t=function(t){var n={};return e(t,{on:function(e,t){n[e]=n[e]||[],n[e].push(t)},fire:function(r,i){i=i||{},e(i,{type:r,target:t,preventDefault:function(){i.returnValue=!1}});var s=n[r]||[];for(var o=0;o<s.length;o++)s[o](i);return i.returnValue!==!1}}),t},n=function(e,t,n){e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&(e["e"+t+n]=n,e.attachEvent("on"+t,function(){e["e"+t+n].call(e,window.event)}))},r="[PROJECT_NAME]",i="postMessage"in window,s=parent==window;return i?o.prototype.send=function(e){this.target.postMessage(r+e,"*")}:o.prototype.send=function(e){var t=window.navigator[r+this.name];if(typeof t!="function")throw new Error("target callback function is not defined");t(r+e,window)},u.prototype.addTarget=function(e){if({}.toString.call(e)==="[object Array]")for(var t=0,n=e.length;t<n;t++)this.addTarget(e[t]);else{var r=new o(s?window.frames[e]:parent,e);this.targets[e]=r}},u.prototype.initListen=function(){var e=this,t=function(t){typeof t=="object"&&t.data&&(t=t.data);if(typeof t!="string"||t.indexOf(r)!=0)return;t=t.slice(r.length),e.fire("message",{msg:t,ts:(+(new Date)).toString(36)})};i?n(window,"message",t):window.navigator[r+this.name]=t},u.prototype.send=function(e){var t=this.targets,n;for(n in t)t.hasOwnProperty(n)&&t[n].send(e)},u});var Viewer={version:"1.0",author:"poker"};typeof JSON=="undefined"&&(window.JSON={parse:function(e){return e.evalExp()}}),Object.mix(Viewer,function(){function t(){var e=document.getElementsByTagName("head")[0];document.createStyleSheet?styleElement=document.createStyleSheet():(styleElement=document.createElement("style"),styleElement.setAttribute("type","text/css"),e.appendChild(styleElement))}function n(e){styleElement||t(),Browser.ie?styleElement.cssText+=e:styleElement.innerHTML+=e}function i(){return"yp-viewer-"+ ++r}function s(e,t,n){Ajax.post(e,t,function(e){var r=JSON.parse(e);r.errno==0?(r.name&&(document.title="360\u4e91\u76d8 - "+r.name.encode4Html()),t.isPdf?u(r.data.rs+"&src=pdf&ofmt=jsonp",n):u(r.data.rs+"&ofmt=jsonp",n)):r.errno==9709?c({type:"needPass"}):c({type:"loadError"})})}function u(t,n){loadJsonp(t,function(r){r.errno==9702?(o++,o<6?setTimeout(function(){u(t,n)},2e3*o):(c({type:"overtime"}),Viewer.ylog(600,{op:"open-doing",type:docData.type,nid:docData.nid,size:docData.size,time:new Date-docData.startLoadTime}),Viewer.clog("preview-open-doing-"+docData.type))):r.errno==0?(e.hide(),Viewer.ylog(600,{op:"open-suc",type:docData.type,nid:docData.nid,size:docData.size,time:new Date-docData.startLoadTime}),Viewer.clog("preview-open-suc-"+docData.type),n(r)):r.errno==9709?c({type:"needPass"}):(c({type:"loadError"}),Viewer.ylog(600,{errno:r.errno,op:"open-fail",type:docData.type,nid:docData.nid,size:docData.size,time:new Date-docData.startLoadTime}),Viewer.clog("preview-open-fail-"+docData.type))})}function a(e,t,n){Viewer.ylog(600,{op:"open",type:docData.type,nid:docData.nid,size:docData.size}),Viewer.clog("preview-open-"+docData.type),docData.startLoadTime=new Date,o=0,c({type:"loading"}),s(e,t,n)}function f(t,n,r){Ajax.post(t,n,function(t){var n=JSON.parse(t);n.errno==0?(n.name&&(document.title="360\u4e91\u76d8 - "+n.name.encode4Html()),e.hide(),Viewer.ylog(600,{op:"open-suc",type:docData.type,nid:docData.nid,size:docData.size,time:new Date-docData.startLoadTime}),Viewer.clog("preview-open-suc-"+docData.type),r(n)):n.errno==9709?c({type:"needPass"}):c({type:"loadError"})})}function l(e,t,n){Viewer.ylog(600,{op:"open",type:docData.type,nid:docData.nid,size:docData.size}),Viewer.clog("preview-open-"+docData.type),docData.startLoadTime=new Date,c({type:"loading"}),f(e,t,n)}function c(t){e&&e.hide();var n="";switch(t.type){case"loading":n='<div class="loading">\u6570\u636e\u52a0\u8f7d\u4e2d\uff0c\u8bf7\u7a0d\u5019...</div>';break;case"loadError":n='<div class="err-msg">\u5443\uff0c\u6587\u6863\u8f7d\u5165\u5931\u8d25</div>';if(docData.shorturl&&docData.nid||docData.filePath)["ppt","word","excel"].indexOf(docData.tplType)>=0&&!docData.isHDPreview&&docData.hd_preview_switch&&!docData.isInbox&&!docData.isSafebox&&!Browser.ie6&&!Browser.ie7?n+='<div class="ex-msg">\u5efa\u8bae<span class="tip-dl" onclick="Viewer.download();">\u76f4\u63a5\u4e0b\u8f7d</span>\u6216\u67e5\u770b<a class="tip-hd" href="'+location.href+'&hdpreview=1">\u9ad8\u6e05\u7248</a></div>':n+='<div class="ex-msg">\u5efa\u8bae<span class="tip-dl" onclick="Viewer.download();">\u76f4\u63a5\u4e0b\u8f7d</span></div>';n='<div class="err">'+n+"</div>";break;case"needPass":n='<div class="err-msg">\u5443\uff0c\u6587\u6863\u6253\u5f00\u9700\u8981\u5bc6\u7801</div>';if(docData.shorturl&&docData.nid||docData.filePath)n+='<div class="ex-msg">\u5efa\u8bae<span class="tip-dl" onclick="Viewer.download();">\u76f4\u63a5\u4e0b\u8f7d</span></div>';n='<div class="err">'+n+"</div>";break;case"overtime":n='<div class="err-msg">\u5443\uff0c\u6587\u6863\u52a0\u8f7d\u8d85\u65f6\uff01</div>';if(docData.shorturl&&docData.nid||docData.filePath)["ppt","word","excel"].indexOf(docData.tplType)>=0&&!docData.isHDPreview&&docData.hd_preview_switch&&!docData.isInbox&&!docData.isSafebox&&!Browser.ie6&&!Browser.ie7?n+='<div class="ex-msg">\u5efa\u8bae\u5237\u65b0\u9875\u9762\u6216<span class="tip-dl" onclick="Viewer.download();">\u76f4\u63a5\u4e0b\u8f7d</span>\u6216\u67e5\u770b<a class="tip-hd" href="'+location.href+'&hdpreview=1">\u9ad8\u6e05\u7248</a></div>':n+='<div class="ex-msg">\u5efa\u8bae\u5237\u65b0\u9875\u9762\u6216<span class="tip-dl" onclick="Viewer.download();">\u76f4\u63a5\u4e0b\u8f7d</span></div>';n='<div class="err">'+n+"</div>";break;case"other":n='<div class="err-msg">'+t.msg+"</div>",t.withDownload&&(docData.shorturl&&docData.nid||docData.filePath)&&(n+='<div class="ex-msg">\u5efa\u8bae<span class="tip-dl" onclick="Viewer.download();">\u76f4\u63a5\u4e0b\u8f7d</span></div>'),n='<div class="err">'+n+"</div>";break;default:return}return e=yunpan.dialog.create({body:'<div id="load">'+n+"</div>",withClose:t.withClose||!1,className:"panel-t3",withMask:t.withMask||!0}),e.show(),e}function h(e){if(e.errno==0){var t=e.data.downloadurl;t.length?W("#ifrDownload").attr("src",t):c({type:"other",msg:"\u5bf9\u4e0d\u8d77\uff0c\u65e0\u6cd5\u4e0b\u8f7d\u8be5\u6587\u4ef6"})}else e.errno==26009?c({type:"other",msg:"\u5443\uff0c\u8be5\u7528\u6237\u672c\u6708\u5916\u94fe\u4e0b\u8f7d\u6d41\u91cf\u4e0d\u8db3\uff0c<br>\u6682\u4e0d\u652f\u6301\u76f4\u63a5\u4e0b\u8f7d\uff01"}):c({type:"other",msg:e.errmsg})}function p(){if(docData.shorturl&&docData.dlDomain){var e=new XPC;e.send("dl")}else docData.isSafebox?Ajax.post("/sFile/download/",{nid:docData.nid},function(e){var t=JSON.parse(e);if(t.errno==0){var n=t.data.download_url;n.length?W("#ifrDownload").attr("src",n):c({type:"other",msg:"\u5bf9\u4e0d\u8d77\uff0c\u65e0\u6cd5\u4e0b\u8f7d\u8be5\u6587\u4ef6"})}else c({type:"other",msg:t.errmsg})}):docData.filePath?Ajax.post("/file/download",{fname:docData.filePath},function(e){var t=JSON.parse(e);if(t.errno==0){var n=t.data.download_url;n.length?W("#ifrDownload").attr("src",n):c({type:"other",msg:"\u5bf9\u4e0d\u8d77\uff0c\u65e0\u6cd5\u4e0b\u8f7d\u8be5\u6587\u4ef6"})}else c({type:"other",msg:t.errmsg})}):c({type:"other",msg:"\u5443\uff0c\u65e0\u6cd5\u4e0b\u8f7d\u6b64\u6587\u4ef6\uff01"})}function d(e){var t="http://s.360.cn/yunpan/click.htm?";t+="u="+encodeURIComponent(location.href),t+="&id=123456",t+="&c="+encodeURIComponent(e),t+="&cId=normal&t="+Math.random();var n=new Image;n.src=t}function v(e,t){var n="/UserBehavior/saveLog",r={sid:e};t&&(r.ext=Object.stringify(t)),Ajax.get(n,r,function(){})}function m(){var e={};return docData.nid=="default"?e.url="/authority/previewInitFile":docData.hisFile==1?(e.url="/FHistory/previewHistory",e.params={id:docData.id,fname:docData.filePath}):(docData.shorturl?docData.isHDPreview&&!Browser.ie6&&!Browser.ie7?e.url="/share/getInfoHD":e.url="/share/getInfo":docData.isSafebox?e.url="/sDocviewer/getInfo":docData.isHDPreview&&!Browser.ie6&&!Browser.ie7?e.url="/docviewer/getInfoHD":e.url="/docviewer/getInfo",e.params={nid:docData.nid,scid:docData.scid,shorturl:docData.shorturl}),e}window.styleElement=null;var e,r=0,o=0;return{addCss:n,id:i,loadDoc:a,loadHDDoc:l,download:p,shareDl:h,clog:d,ylog:v,showMsg:c,getParams:m}}()),Viewer.imgReady=function(){var e=[],t=null,n=function(){var t=0;for(;t<e.length;t++)e[t].end?e.splice(t--,1):e[t]();!e.length&&r()},r=function(){clearInterval(t),t=null};return function(r,i,s,o){var u,a,f,l,c,h=new Image;h.src=r;if(h.complete){i.call(h),s&&s.call(h);return}a=h.width,f=h.height,h.onerror=function(){o&&o.call(h),u.end=!0,h=h.onload=h.onerror=null},u=function(){l=h.width,c=h.height;if(l!==a||c!==f||l*c>1024)i.call(h),u.end=!0},u(),h.onload=function(){!u.end&&u(),s&&s.call(h),h=h.onload=h.onerror=null},u.end||(e.push(u),t===null&&(t=setInterval(n,40)))}}(),Viewer.Resizer=function(e){this.options=Object.mix({id:Viewer.id(),container:document.body,noLatency:!1,latency:100,zoomRate:100,listeners:{}},e,!0),this.oResizer=null,this.oZoomout=null,this.oZoomin=null,this._data={},this.isDragging=!1,this.dragMask=null,this._init()},Viewer.Resizer._xtpml=['<div id="{$id}" class="x-resizer {$cls}">','<span class="x-zoom-per">100%</span>','<span class="x-zoom-bar"></span>','<span class="x-zoomout"></span>','<span class="x-zoomin"></span>','<span class="x-zoom-handle"></span>',"</div>"].join(""),Viewer.Resizer.prototype={_init:function(){var e=this.options,t=W(Viewer.Resizer._xtpml.tmpl(e)).insertTo("beforeend",W(e.container)[0]);this.oResizer=t,this.oHandle=t.query(".x-zoom-handle"),this.oZoomout=t.query(".x-zoomout"),this.oZoomin=t.query(".x-zoomin"),this.oPer=t.query(".x-zoom-per"),this.oBody=W(document.body);var n=this.oHandle.getRect(),r=this.oResizer.query(".x-zoom-bar").getRect(),i=this.oResizer.getRect();this._data.maxX=r.left-i.left+r.width-n.width,this._data.minX=r.left-i.left,this._data.half=(r.width-n.width)/2,this._data.comX=i.left,this.setPercentage(this.options.zoomRate);var s=this;this.oHandle.on("mousedown",function(e){s._dragStart(e)}),this.oZoomin.click(function(e){s.zoomin(e)}),this.oZoomout.click(function(e){s.zoomout(e)})},_dragStart:function(e){function i(e){t._drag(e)}function s(e){t.oBody.un("mousemove",i).un("mouseup",s),t.isDragging=!1,t.dragMask.css("display","none")}if(this.isDragging)return;var t=this,n=this.oHandle.getRect();this.dragMask||(this.dragMask=W('<div class="x-resizer-mask"></div>').insertTo("beforeend",document.body));var r=Dom.getDocRect();this.dragMask.css({width:r.width+"px",height:r.height+"px",display:"block"},!0),this._data.deltX=e.clientX-n.left,this.oBody.on("mousemove",i).on("mouseup",s),this.isDragging=!0,e.preventDefault()},_getPercentage:function(e){var t=this._data;return e-t.minX<=t.half?10+Math.floor((e-t.minX)*90/t.half):100+Math.floor((e-t.minX-t.half)*300/t.half)},_drag:function(e){var t=e.clientX,n=this.options,r=t-this._data.comX-this._data.deltX,i=this._data,s=r<i.minX?i.minX:r>i.maxX?i.maxX:r,o=this;this.oHandle.css("left",s+"px"),this._data.percentage=this._getPercentage(s),this.oPer.html(this._data.percentage+"%"),this.fireChangeEvent(),e.preventDefault()},setPercentage:function(e){var t=this._data,n;e<=100?n=(e-10)*t.half/90+t.minX:n=(e-100)*t.half/300+t.minX+t.half,this._data.percentage=e,this.oPer.html(e+"%"),this.fireChangeEvent(),this.oHandle.css("left",n+"px")},zoomin:function(){var e=Math.floor(this._data.percentage/10)*10+10;e>400&&(e=400),this.setPercentage(e)},zoomout:function(){var e=Math.ceil(this._data.percentage/10)*10-10;e<10&&(e=10),this.setPercentage(e)},fireChangeEvent:function(){var e=this.options,t=this;e.noLatency?e.listeners.change&&e.listeners.change(t._data.percentage):(this._data.timeoutId&&(clearTimeout(this._data.timeoutId),this._data.timeoutId=null),this._data.timeoutId=setTimeout(function(){e.listeners.change&&e.listeners.change(t._data.percentage)},e.latency))}};var PdfViewer=function(){function u(){yunpan.Storage.set(docData.nid+"-scroll",n[0].scrollLeft+"-"+n[0].scrollTop)}function f(t){e=t<10?10:t>400?400:t;var n=parseInt(s*e/100),i=parseInt(o*e/100);W("#pages img").css({width:n+"px",height:i+"px"}),yunpan.Storage.set(docData.nid+"-zoom",e),r&&r.loadImg()}function l(){if((this.width==0||this.height==0)&&!a){a=!0,setTimeout(function(){Viewer.imgReady(t[0],l,null,l)},1e3);return}s=this.width,o=this.height,c();var r=yunpan.Storage.get(docData.nid+"-zoom")||Math.floor(1e3/s*10)*10;r=parseInt(r,10);if(docData.isInbox){var h=new XPC("docViewerIfr");h.on("message",function(t){t&&t.msg&&(t.msg=="zoomin"?(e+=10,f(e)):t.msg=="zoomout"?(e-=10,f(e)):t.msg=="relayout"&&resizeLayout())}),f(r)}else var p=new Viewer.Resizer({container:g("bottombar"),noLatency:!0,cls:"resizer",zoomRate:r,listeners:{change:f}});n.on("scroll",function(){i&&(clearTimeout(i),i=null),i=setTimeout(u,1e3)});if(yunpan.Storage.get(docData.nid+"-scroll")){var d=yunpan.Storage.get(docData.nid+"-scroll").split("-");if(d.length<2)return;var v=parseInt(d[0]),m=parseInt(d[1]);if(typeof v!="number"||typeof m!="number")return;n[0].scrollLeft=v,n[0].scrollTop=m}W("#mask").fadeOut()}function c(){var e=[];for(var i=0,s=t.length;i<s;i++)e.push('<div class="page-box"><img src="/resource/img/blank.gif" data-imgurl="'+t[i]+'" /></div>');n.html(e.join("")),r=new yunpan.util.Lazyload({container:"#pages",checkInterval:100,threshold:595}),r.start()}function h(){n=W("#pages");var e=Viewer.getParams().params,r=getPdfPluginInfo();e.isPdf=!1,r.pdfPlugin&&(e.isPdf=!0),Viewer.loadDoc(Viewer.getParams().url,e,function(n){n.errno==0?e.isPdf&&n.data.type=="pdf"?location.href="/docviewer/pdf?name="+encodeURIComponent(n.data.name)+"&url="+encodeURIComponent(n.data.url):n.data&&n.data.url?(t=n.data.url,t.length>0&&Viewer.imgReady(t[0],l,null,l)):Viewer.showMsg({type:"other",msg:"\u6587\u6863\u8f6c\u6362\u5931\u8d25\uff01",withDownload:!0}):Viewer.showMsg({type:"other",msg:n.errmsg})})}var e=100,t,n,r,i,s,o,a=!1;return{init:h}}();Dom.ready(function(){var e=W("#pages"),t,n,r,i=100,s;docData.isInbox?r=W(".toolbar"):(t=W("#bottombar"),n=t.getRect().height);var o=Dom.getDocRect();W("#mask").css({width:o.width+"px",height:o.height+"px"});var u=window.resizeLayout=function(){var r=Dom.getDocRect(),i=r.width,s=r.height;if(docData.isInbox)e.css({width:i+"px",height:s+"px"});else{var o=s-n;e.css({width:i+"px",height:o+"px"}),t.css("top",s-n+"px").css("width",i+"px")}};W(window).on("resize",function(){s&&(clearTimeout(s),s=null),s=setTimeout(u,i)}),u(),PdfViewer.init()});var getPdfPluginInfo=function(){var e=function(){return this.name=this.name||function(){var e=navigator?navigator.userAgent.toLowerCase():"other";return e.indexOf("chrome")>-1?"chrome":e.indexOf("safari")>-1?"safari":e.indexOf("msie")>-1?"ie":e.indexOf("firefox")>-1?"firefox":e}()},t=function(e){try{return new ActiveXObject(e)}catch(t){}},n=function(e){for(key in navigator.plugins){var t=navigator.plugins[key];if(t.name==e)return t}},r=function(){var r=Browser.firefox,i=!1;if(r){var s=Browser.firefox,o=parseInt(s);o>=19&&(i=!0)}return this.plugin=this.plugin||function(){return e()=="ie"?t("AcroPDF.PDF")||t("PDF.PdfCtrl"):n("Adobe Acrobat")||n("Chrome PDF Viewer")||n("WebKit built-in PDF")||i}()},i=function(){return!!r()},s=function(){try{var t=r();if(e()=="ie"){var n=t.GetVersions().split(","),i=n[0].split("=");return parseFloat(i[1])}return t.version?parseInt(t.version):t.name}catch(s){return null}};return{browser:e(),pdfPlugin:i()?!0:!1,pdfPluginVersion:s()}};